<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>飲料購物網站（範本）</title>
  <style>
    :root{--accent:#0077cc;--muted:#666;--card:#fff;--bg:#f6f7fb}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans TC',"PingFang TC",Helvetica,Arial;background:var(--bg);margin:0;color:#222}
    header{background:linear-gradient(90deg,var(--accent),#00b3a6);color:#fff;padding:18px 20px;display:flex;align-items:center;justify-content:space-between}
    header h1{margin:0;font-size:18px}
    .container{max-width:1100px;margin:18px auto;padding:12px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(10,20,40,0.06)}
    .product-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}

    .prod{border-radius:10px;padding:10px;background:#fff;display:flex;flex-direction:column;gap:8px}
    .prod img{height:120px;object-fit:cover;border-radius:8px}
    .prod .title{font-weight:600}
    .small{font-size:13px;color:var(--muted)}

    button{background:var(--accent);border:none;color:#fff;padding:8px 10px;border-radius:8px;cursor:pointer}
    button.secondary{background:#eee;color:#222}
    .cart-item{display:flex;gap:8px;align-items:center}
    input,select,textarea{padding:8px;border-radius:8px;border:1px solid #ddd;width:100%}
    .flex{display:flex;gap:8px;align-items:center}
    .space-between{display:flex;justify-content:space-between;align-items:center}
    .muted{color:var(--muted)}
    .low-stock{color:#c0392b;font-weight:700}
    .admin-panel{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-bottom:1px solid #eee;padding:8px;text-align:left}
    footer{padding:12px;text-align:center;color:var(--muted);font-size:13px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}.admin-panel{grid-template-columns:1fr}}
  </style>
</head>
<body>
<header>
  <h1>飲料購物網站（範本）</h1>
  <div class="flex">
    <button id="btn-admin" class="secondary">切換管理模式</button>
    <button id="btn-export" title="匯出產品與銷售記錄">匯出CSV</button>
  </div>
</header>

<main class="container">
  <div class="grid">
    <section>
      <div class="card">
        <div class="space-between">
          <div>
            <h2 style="margin:0">商品列表</h2>
            <div class="small">搜尋/篩選</div>
          </div>
          <div class="flex">
            <input id="search" placeholder="搜尋飲料或標籤" />
            <select id="filter-cat"><option value="">全部類別</option></select>
          </div>
        </div>

        <div style="margin-top:12px" class="product-list" id="product-list"></div>
      </div>

      <div class="card" style="margin-top:14px">
        <h3 style="margin:0">銷售歷史</h3>
        <div id="sales-log" style="margin-top:8px;max-height:200px;overflow:auto"></div>
      </div>
    </section>

    <aside>
      <div class="card">
        <h3 style="margin:0">購物車</h3>
        <div id="cart-list" style="margin-top:8px;max-height:350px;overflow:auto"></div>
        <div style="margin-top:10px" class="space-between">
          <div class="small">合計:</div>
          <div id="cart-total">NT$0</div>
        </div>
        <div style="margin-top:10px" class="flex">
          <button id="checkout">結帳</button>
          <button id="clear-cart" class="secondary">清空</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3 style="margin:0">庫存總覽</h3>
        <div id="inventory" style="margin-top:8px;max-height:280px;overflow:auto"></div>
      </div>
    </aside>
  </div>

  <div id="admin-area" style="margin-top:18px;display:none" class="card">
    <h3 style="margin:0">管理面板（新增/編輯產品）</h3>
    <div class="admin-panel" style="margin-top:10px">
      <div>
        <label>品名</label>
        <input id="p-title" />
        <label>價格（NT$）</label>
        <input id="p-price" type="number" />
        <label>庫存數量</label>
        <input id="p-stock" type="number" />
        <label>類別（逗號分隔）</label>
        <input id="p-tags" placeholder="例: 茶,無糖,現萃" />
      </div>
      <div>
        <label>圖片 URL</label>
        <input id="p-img" placeholder="可留空使用示範圖" />
        <label>描述</label>
        <textarea id="p-desc" rows="4"></textarea>
        <div style="margin-top:8px" class="flex">
          <button id="add-product">新增商品</button>
          <button id="update-product" class="secondary" style="display:none">儲存修改</button>
          <button id="cancel-edit" class="secondary" style="display:none">取消</button>
        </div>
      </div>
    </div>

    <hr style="margin:12px 0">
    <h4>產品清單</h4>
    <table class="table" id="admin-table"><thead><tr><th>品名</th><th>價格</th><th>庫存</th><th>操作</th></tr></thead><tbody></tbody></table>
  </div>
</main>

<footer>範本系統 — 使用 localStorage 做示範。可另接後端 API 或加入匯入/匯出功能。</footer>

<script>
// 小型前端進銷存示範，單檔運作，資料存在 localStorage
const SAMPLE = [
  {id:1,title:'古早味紅茶',price:30,stock:120,tags:['茶','無糖'],img:'https://picsum.photos/seed/tea/400/300',desc:'古早味黑糖紅茶'},
  {id:2,title:'鮮榨柳橙汁',price:70,stock:40,tags:['果汁','新鮮'],img:'https://picsum.photos/seed/orange/400/300',desc:'每日現榨，無添加'},
  {id:3,title:'氣泡綠茶',price:45,stock:6,tags:['茶','氣泡'],img:'https://picsum.photos/seed/soda/400/300',desc:'夏日清爽選擇'}
];

function idNow(){return Date.now()+Math.floor(Math.random()*1000)}

// storage helpers
function load(key, fallback){try{const v=localStorage.getItem(key);return v?JSON.parse(v):fallback}catch(e){return fallback}}
function save(key,data){localStorage.setItem(key,JSON.stringify(data))}

let products = load('products', SAMPLE);
let cart = load('cart', []);
let sales = load('sales', []);

// UI elements
const productListEl = document.getElementById('product-list');
const inventoryEl = document.getElementById('inventory');
const cartListEl = document.getElementById('cart-list');
const cartTotalEl = document.getElementById('cart-total');
const salesLogEl = document.getElementById('sales-log');
const filterCat = document.getElementById('filter-cat');
const searchEl = document.getElementById('search');

function renderCategories(){
  const cats = new Set(); products.forEach(p=>p.tags.forEach(t=>cats.add(t.trim())));
  filterCat.innerHTML = '<option value="">全部類別</option>' + [...cats].map(c=>`<option value="${c}">${c}</option>`).join('')
}

function renderProducts(){
  const q = searchEl.value.trim().toLowerCase();
  const cat = filterCat.value;
  productListEl.innerHTML = '';
  products.filter(p=>{
    if(cat && !p.tags.includes(cat)) return false;
    if(!q) return true;
    return p.title.toLowerCase().includes(q) || p.tags.join(',').toLowerCase().includes(q) || (p.desc||'').toLowerCase().includes(q)
  }).forEach(p=>{
    const div = document.createElement('div'); div.className='prod';
    div.innerHTML = `
      <img src="${p.img||'https://picsum.photos/400/300?random='+p.id}" alt="${p.title}">
      <div class="title">${p.title}</div>
      <div class="small">${p.desc||''}</div>
      <div class="flex space-between"><div class="small">NT$${p.price} <span class="muted">庫存:${p.stock>0?p.stock:'售罄'}</span></div><div><button data-id="${p.id}">加入購物車</button></div></div>
    `;
    if(p.stock<=5) { const badge = document.createElement('div'); badge.textContent='低庫存'; badge.className='low-stock'; div.prepend(badge) }
    productListEl.appendChild(div);
  })
}

function renderInventory(){
  inventoryEl.innerHTML='';
  products.forEach(p=>{
    const row = document.createElement('div');
    row.style.display='flex';row.style.justifyContent='space-between';row.style.alignItems='center';row.style.marginBottom='8px'
    row.innerHTML = `<div><div style="font-weight:600">${p.title}</div><div class="small">NT$${p.price} • ${p.tags.join(',')}</div></div><div class="flex"><div class="small">${p.stock}</div><button class="secondary" data-restock="${p.id}">補貨</button></div>`
    inventoryEl.appendChild(row);
  })
}

function renderCart(){
  cartListEl.innerHTML='';
  let total=0;
  cart.forEach(item=>{
    const prod = products.find(p=>p.id===item.id);
    if(!prod) return;
    total += prod.price * item.qty;
    const el = document.createElement('div'); el.className='cart-item';
    el.innerHTML = `<div style="flex:1"><div>${prod.title} <span class="small">x${item.qty}</span></div><div class="small">NT$${prod.price} each</div></div><div class="flex"><button class="secondary" data-dec="${item.id}">-</button><button data-inc="${item.id}">+</button></div>`
    cartListEl.appendChild(el);
  })
  cartTotalEl.textContent = 'NT$' + total;
}

function renderSales(){
  salesLogEl.innerHTML='';
  if(sales.length===0){salesLogEl.innerHTML='<div class="small">尚無銷售記錄</div>';return}
  sales.slice().reverse().forEach(s=>{
    const d = new Date(s.time).toLocaleString();
    const div = document.createElement('div'); div.style.borderBottom='1px solid #f0f0f0'; div.style.padding='8px 0';
    div.innerHTML = `<div style="font-weight:600">${d} • NT$${s.total}</div><div class="small">${s.items.map(it=>it.title+ ' x'+it.qty).join('；')}</div>`
    salesLogEl.appendChild(div);
  })
}

// cart ops
productListEl.addEventListener('click', e=>{
  const id = e.target.dataset.id; if(!id) return;
  const pid = Number(id); const p = products.find(x=>x.id===pid); if(!p||p.stock<=0){alert('商品無庫存');return}
  const existing = cart.find(c=>c.id===pid);
  if(existing){ if(existing.qty+1>p.stock){alert('超過庫存');return} existing.qty+=1 } else cart.push({id:pid,qty:1})
  save('cart',cart); renderCart();
})

cartListEl.addEventListener('click', e=>{
  const inc = e.target.dataset.inc; const dec = e.target.dataset.dec;
  if(inc){ const id=Number(inc); const it = cart.find(c=>c.id===id); const p=products.find(x=>x.id===id); if(it.qty+1>p.stock){alert('超過庫存');return} it.qty+=1; save('cart',cart); renderCart(); }
  if(dec){ const id=Number(dec); const it = cart.find(c=>c.id===id); if(!it) return; it.qty-=1; if(it.qty<=0){cart = cart.filter(c=>c.id!==id)} save('cart',cart); renderCart(); }
})

// checkout
document.getElementById('checkout').addEventListener('click', ()=>{
  if(cart.length===0){alert('購物車為空');return}
  // check stock
  for(const it of cart){ const p = products.find(x=>x.id===it.id); if(!p||p.stock<it.qty){alert(`商品 ${p? p.title:'已移除'} 庫存不足`);return} }
  // reduce stock
  const items = cart.map(it=>{ const p = products.find(x=>x.id===it.id); p.stock -= it.qty; return {id:p.id,title:p.title,qty:it.qty,price:p.price} });
  const total = items.reduce((s,i)=>s+i.qty*i.price,0);
  const sale = {id:idNow(),time:Date.now(),items,total};
  sales.push(sale); save('sales',sales);
  save('products',products);
  cart = []; save('cart',cart);
  renderAll();
  alert('結帳成功 NT$'+total);
})

document.getElementById('clear-cart').addEventListener('click', ()=>{ cart=[]; save('cart',cart); renderCart() })

// admin area
const adminArea = document.getElementById('admin-area');
const btnAdmin = document.getElementById('btn-admin');
btnAdmin.addEventListener('click', ()=>{ adminArea.style.display = adminArea.style.display==='none'?'block':'none' })

function renderAdminTable(){
  const tbody = document.querySelector('#admin-table tbody'); tbody.innerHTML = '';
  products.forEach(p=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${p.title}</td><td>NT$${p.price}</td><td>${p.stock}</td><td><button data-edit="${p.id}" class="secondary">編輯</button> <button data-del="${p.id}">刪除</button></td>`
    tbody.appendChild(tr);
  })
}

document.querySelector('#admin-table tbody').addEventListener('click', e=>{
  const id = e.target.dataset.edit || e.target.dataset.del; if(!id) return; const pid=Number(id);
  if(e.target.dataset.edit){ startEdit(pid) }
  if(e.target.dataset.del){ if(confirm('確定刪除？')){ products = products.filter(p=>p.id!==pid); save('products',products); renderAll(); } }
})

// admin forms
const $title = document.getElementById('p-title');
const $price = document.getElementById('p-price');
const $stock = document.getElementById('p-stock');
const $tags = document.getElementById('p-tags');
const $img = document.getElementById('p-img');
const $desc = document.getElementById('p-desc');
let editingId = null;

function startEdit(id){ const p = products.find(x=>x.id===id); if(!p) return; editingId=id; $title.value=p.title; $price.value=p.price; $stock.value=p.stock; $tags.value=p.tags.join(','); $img.value=p.img||''; $desc.value=p.desc||''; document.getElementById('add-product').style.display='none'; document.getElementById('update-product').style.display='inline-block'; document.getElementById('cancel-edit').style.display='inline-block' }

document.getElementById('cancel-edit').addEventListener('click', ()=>{ editingId=null; clearForm(); })

document.getElementById('add-product').addEventListener('click', ()=>{
  const p = {id:idNow(),title:$title.value||'未命名',price:Math.max(0,Number($price.value)||0),stock:Math.max(0,Number($stock.value)||0),tags:($tags.value||'').split(',').map(s=>s.trim()).filter(Boolean),img:$img.value,desc:$desc.value}
  products.push(p); save('products',products); clearForm(); renderAll(); alert('已新增')
})

document.getElementById('update-product').addEventListener('click', ()=>{
  if(!editingId) return; const p=products.find(x=>x.id===editingId); p.title=$title.value||p.title; p.price=Math.max(0,Number($price.value)||p.price); p.stock=Math.max(0,Number($stock.value)||p.stock); p.tags=($tags.value||'').split(',').map(s=>s.trim()).filter(Boolean); p.img=$img.value; p.desc=$desc.value; save('products',products); editingId=null; clearForm(); renderAll(); alert('已修改')
})

function clearForm(){ $title.value=''; $price.value=''; $stock.value=''; $tags.value=''; $img.value=''; $desc.value=''; document.getElementById('add-product').style.display='inline-block'; document.getElementById('update-product').style.display='none'; document.getElementById('cancel-edit').style.display='none' }

// restock button
inventoryEl.addEventListener('click', e=>{
  const id = e.target.dataset.restock; if(!id) return; const p = products.find(x=>x.id===Number(id)); const qty = prompt('補貨數量', '20'); if(!qty) return; p.stock += Number(qty); save('products',products); renderAll(); })

// export CSV
function toCSV(rows){ return rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n') }

document.getElementById('btn-export').addEventListener('click', ()=>{
  // 2檔案：products & sales
  const prodRows = [['id','title','price','stock','tags','desc']].concat(products.map(p=>[p.id,p.title,p.price,p.stock,p.tags.join(','),p.desc||'']));
  const salesRows = [['id','time','total','items']].concat(sales.map(s=>[s.id,new Date(s.time).toLocaleString(),s.total,s.items.map(it=>it.title+' x'+it.qty).join('; ')]));
  downloadFile('products.csv', toCSV(prodRows)); downloadFile('sales.csv', toCSV(salesRows));
})

function downloadFile(filename, text){ const a=document.createElement('a'); a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(text); a.download=filename; a.click(); }

// search / filter events
searchEl.addEventListener('input', ()=>renderProducts()); filterCat.addEventListener('change', ()=>renderProducts());

// render admin list
function renderAdminUI(){ renderAdminTable(); }

// initial render
function renderAll(){ renderCategories(); renderProducts(); renderInventory(); renderCart(); renderSales(); renderAdminUI(); }
renderAll();

// if no products in storage (first time), seed
if(!localStorage.getItem('products')){ products=SAMPLE; save('products',products); }

</script>
</body>
</html>
